<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Gastos</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="/" class="nav-brand">Gestor de Gastos</a>
            <ul class="nav-links">
                <li><a href="/" class="active">Dashboard</a></li>
                <li><a href="#" id="navAddExpense">+ Gasto</a></li>
                <li><a href="#" id="navAddIncome">+ Ingreso</a></li>
                <li><a href="/history.html">Historial</a></li>
                <li class="dropdown">
                    <a href="#">Categorías ▾</a>
                    <ul class="dropdown-menu">
                        <li><a href="/fixed-expenses.html">Gastos Fijos</a></li>
                        <li><a href="/variable-expenses.html">Gastos Variables</a></li>
                        <li><a href="/daily-expenses.html">Gastos Diarios</a></li>
                        <li><a href="/incomes-config.html">Ingresos</a></li>
                    </ul>
                </li>
                <li><a href="/settings.html">Configuración</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div id="alertContainer"></div>

        <!-- Month Selector -->
        <div class="dashboard-header">
            <div class="month-selector">
                <button id="prevMonth" class="month-nav-btn">‹</button>
                <span id="currentMonthLabel">Enero 2025</span>
                <button id="nextMonth" class="month-nav-btn">›</button>
            </div>
            <div class="quick-actions">
                <button id="btnQuickExpense" class="btn btn-primary">+ Gasto</button>
                <button id="btnQuickIncome" class="btn btn-success">+ Ingreso</button>
            </div>
        </div>

        <!-- Main Stats -->
        <div class="stats-row">
            <div class="stat-card stat-income">
                <div class="stat-icon">↑</div>
                <div class="stat-content">
                    <div class="stat-label">Ingresos</div>
                    <div class="stat-value" id="dashIncome">€0.00</div>
                </div>
            </div>
            <div class="stat-card stat-expense">
                <div class="stat-icon">↓</div>
                <div class="stat-content">
                    <div class="stat-label">Gastos</div>
                    <div class="stat-value" id="dashExpenses">€0.00</div>
                </div>
            </div>
            <div class="stat-card stat-balance">
                <div class="stat-icon">=</div>
                <div class="stat-content">
                    <div class="stat-label">Balance</div>
                    <div class="stat-value" id="dashBalance">€0.00</div>
                </div>
            </div>
        </div>

        <!-- Two Column Layout -->
        <div class="dashboard-grid">
            <!-- Left Column -->
            <div class="dashboard-column">
                <!-- Fixed Expenses Checklist -->
                <div class="card">
                    <div class="card-header">
                        <span>Gastos Fijos del Mes</span>
                    </div>
                    <div id="fixedExpensesChecklist">
                        <p class="text-muted text-center">Cargando...</p>
                    </div>
                </div>

                <!-- Categories Summary -->
                <div class="card">
                    <div class="card-header">
                        <span>Gastos por Categoría</span>
                    </div>
                    <div id="categoriesSummary">
                        <p class="text-muted text-center">Cargando...</p>
                    </div>
                </div>

                <!-- Settlements -->
                <div class="card">
                    <div class="card-header">
                        <span>Liquidaciones</span>
                    </div>
                    <div id="settlementsSection">
                        <p class="text-muted text-center">Cargando...</p>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="dashboard-column">
                <!-- Recent Transactions -->
                <div class="card">
                    <div class="card-header">
                        <span>Últimos Movimientos</span>
                        <a href="/history.html" class="btn btn-sm btn-secondary">Ver todo</a>
                    </div>
                    <div id="recentTransactions">
                        <p class="text-muted text-center">Cargando...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Expense Modal -->
    <div id="quickExpenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Agregar Gasto</h2>
                <button class="modal-close" onclick="closeQuickExpense()">&times;</button>
            </div>
            <form id="quickExpenseForm">
                <!-- Tipo de gasto -->
                <div class="form-group">
                    <label>Tipo de Gasto</label>
                    <div class="type-selector" id="typeSelector">
                        <button type="button" class="type-btn" data-type="fijo">Fijo</button>
                        <button type="button" class="type-btn" data-type="variable">Variable</button>
                        <button type="button" class="type-btn active" data-type="diario">Diario</button>
                    </div>
                    <input type="hidden" id="qType" name="type" value="diario">
                </div>

                <!-- Categoría -->
                <div class="form-group">
                    <label>Categoría</label>
                    <div class="category-selector" id="categorySelector">
                        <!-- Se llena dinámicamente -->
                    </div>
                    <input type="hidden" id="qCategory" name="category" value="">
                </div>

                <!-- Monto y Fecha -->
                <div class="form-grid">
                    <div class="form-group">
                        <label for="qAmount">Monto (€)</label>
                        <input type="number" id="qAmount" name="amount" step="0.01" min="0.01" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="qDate">Fecha</label>
                        <input type="date" id="qDate" name="date" required>
                    </div>
                </div>

                <!-- Pagado por -->
                <div class="form-group">
                    <label>Pagado por</label>
                    <div class="person-selector" id="personSelector">
                        <!-- Se llena dinámicamente -->
                    </div>
                    <input type="hidden" id="qPaidBy" name="paidBy" value="">
                </div>

                <!-- Gasto común -->
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="qIsShared" name="isShared" checked>
                        <span>Gasto común (compartido)</span>
                    </label>
                </div>

                <!-- Descripción -->
                <div class="form-group">
                    <label for="qDescription">Descripción (opcional)</label>
                    <input type="text" id="qDescription" name="description" placeholder="Ej: Compra supermercado">
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeQuickExpense()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Settlement Modal -->
    <div id="settlementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Registrar Pago</h2>
                <button class="modal-close" onclick="closeSettlementModal()">&times;</button>
            </div>
            <form id="settlementForm">
                <input type="hidden" id="settlementMonth" name="month">
                <input type="hidden" id="settlementFrom" name="from">
                <input type="hidden" id="settlementTo" name="to">

                <div class="settlement-info" id="settlementInfo"></div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="settlementAmount">Monto (€)</label>
                        <input type="number" id="settlementAmount" name="amount" step="0.01" min="0.01" required>
                    </div>

                    <div class="form-group">
                        <label for="settlementDate">Fecha</label>
                        <input type="date" id="settlementDate" name="date" required>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeSettlementModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Registrar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Quick Income Modal -->
    <div id="quickIncomeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Agregar Ingreso</h2>
                <button class="modal-close" onclick="closeQuickIncome()">&times;</button>
            </div>
            <form id="quickIncomeForm">
                <!-- Categoría -->
                <div class="form-group">
                    <label>Categoría</label>
                    <div class="category-selector" id="incomeCategorySelector">
                        <!-- Se llena dinámicamente -->
                    </div>
                    <input type="hidden" id="iCategory" name="category" value="">
                </div>

                <!-- Monto y Fecha -->
                <div class="form-grid">
                    <div class="form-group">
                        <label for="iAmount">Monto (€)</label>
                        <input type="number" id="iAmount" name="amount" step="0.01" min="0.01" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="iDate">Fecha</label>
                        <input type="date" id="iDate" name="date" required>
                    </div>
                </div>

                <!-- Recibido por -->
                <div class="form-group">
                    <label>Recibido por</label>
                    <div class="person-selector" id="incomePersonSelector">
                        <!-- Se llena dinámicamente -->
                    </div>
                    <input type="hidden" id="iReceivedBy" name="receivedBy" value="">
                </div>

                <!-- Descripción -->
                <div class="form-group">
                    <label for="iDescription">Descripción (opcional)</label>
                    <input type="text" id="iDescription" name="description" placeholder="Ej: Salario enero">
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeQuickIncome()">Cancelar</button>
                    <button type="submit" class="btn btn-success">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/js/auth.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/dashboard.js"></script>
</body>
</html>
