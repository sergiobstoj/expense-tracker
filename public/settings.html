<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraci贸n - Gestor de Gastos</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="/" class="nav-brand"> Gestor de Gastos</a>
            <ul class="nav-links">
                <li><a href="/">Dashboard</a></li>
                <li><a href="/" id="navAddExpense">+ Gasto</a></li>
                <li><a href="/incomes.html">+ Ingreso</a></li>
                <li><a href="/history.html">Historial</a></li>
                <li><a href="/reports.html">Reportes</a></li>
                <li><a href="/settings.html" class="active">Configuraci贸n</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>Configuraci贸n</h1>
            <p>Administra personas, categor铆as y porcentajes de divisi贸n</p>
        </div>

        <div id="alertContainer"></div>

        <!-- Personas y Porcentajes -->
        <div class="card">
            <div class="card-header">Personas y Porcentaje de Divisi贸n (Predeterminado)</div>
            <p style="color: #6b7280; margin-bottom: 1rem;">
                Define el porcentaje predeterminado que se aplicar谩 a los nuevos meses. Los meses existentes mantienen sus porcentajes hist贸ricos.
            </p>
            <form id="personsForm">
                <div id="personsContainer"></div>
                <button type="submit" class="btn btn-primary mt-3">Guardar Cambios</button>
            </form>
        </div>

        <!-- Porcentajes Mensuales -->
        <div class="card">
            <div class="card-header">Porcentajes por Mes</div>
            <p style="color: #6b7280; margin-bottom: 1rem;">
                Configura porcentajes espec铆ficos para cada mes. Esto permite ajustar la divisi贸n de gastos sin afectar los reportes hist贸ricos.
            </p>

            <div class="mb-3">
                <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">Meses Configurados</h3>
                <div id="monthlyPercentagesContainer">
                    <p style="color: #6b7280; font-style: italic;">Cargando...</p>
                </div>
            </div>

            <div>
                <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">Editar Porcentajes de un Mes</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="monthToEdit">Selecciona el mes</label>
                        <select id="monthToEdit" style="max-width: 300px;">
                            <option value="">Selecciona un mes...</option>
                        </select>
                    </div>
                </div>
                <div id="monthPercentagesForm" style="display: none; margin-top: 1rem;">
                    <div id="monthPercentagesInputs"></div>
                    <button type="button" id="btnSaveMonthPercentages" class="btn btn-primary mt-2">Guardar Porcentajes del Mes</button>
                </div>
            </div>
        </div>

        <!-- PIN Management -->
        <div class="card">
            <div class="card-header">Gesti贸n de PINs</div>
            
            <div class="mb-3">
                <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">PINs de Usuario</h3>
                <div id="userPinsContainer"></div>
            </div>

            <div class="mb-3">
                <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">PIN Maestro</h3>
                <form id="masterPinForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="currentMasterPin">PIN Maestro Actual</label>
                            <input type="password" id="currentMasterPin" maxlength="4" placeholder="****" required>
                        </div>
                        <div class="form-group">
                            <label for="newMasterPin">Nuevo PIN Maestro</label>
                            <input type="password" id="newMasterPin" maxlength="4" placeholder="****" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary mt-2">Cambiar PIN Maestro</button>
                </form>
            </div>
        </div>

        <!-- Appearance -->
        <div class="card">
            <div class="card-header">Apariencia</div>

            <div class="form-group">
                <label for="themeToggle" style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;">
                    <span>
                        <strong>Modo Oscuro</strong>
                        <p style="color: #6b7280; font-size: 0.875rem; margin-top: 0.25rem;">Cambia la apariencia de la aplicaci贸n</p>
                    </span>
                    <label class="theme-switch">
                        <input type="checkbox" id="themeToggle">
                        <span class="theme-slider"></span>
                    </label>
                </label>
            </div>
        </div>

        <!-- Month Closure -->
        <div class="card">
            <div class="card-header">Cierre de Mes</div>
            
            <p style="color: #6b7280; margin-bottom: 1rem;">
                Cierra un mes para evitar modificaciones accidentales. Los meses cerrados no permitir谩n agregar o editar gastos/ingresos.
            </p>

            <div class="mb-3">
                <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">Meses Cerrados</h3>
                <div id="closedMonthsContainer">
                    <p style="color: #6b7280; font-style: italic;">No hay meses cerrados</p>
                </div>
            </div>

            <div>
                <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">Cerrar Nuevo Mes</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="monthToClose">Selecciona el mes a cerrar</label>
                        <input type="month" id="monthToClose" style="max-width: 200px;">
                    </div>
                    <div style="display: flex; align-items: flex-end;">
                        <button type="button" id="btnCloseMonth" class="btn btn-danger">Cerrar Mes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Categor铆as -->
        <div class="card">
            <div class="card-header">Gesti贸n de Categor铆as de Gastos</div>
            
            <div class="mb-3">
                <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">Gastos Fijos</h3>
                <div id="categoriesFijo"></div>
                <form id="addCategoryFijo" class="mt-2">
                    <div class="flex gap-2">
                        <input type="text" name="newCategory" placeholder="Nueva categor铆a fija" class="form-group" style="flex: 1; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.375rem;">
                        <button type="submit" class="btn btn-sm btn-primary">Agregar</button>
                    </div>
                </form>
            </div>

            <div class="mb-3">
                <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">Gastos Variables</h3>
                <div id="categoriesVariable"></div>
                <form id="addCategoryVariable" class="mt-2">
                    <div class="flex gap-2">
                        <input type="text" name="newCategory" placeholder="Nueva categor铆a variable" class="form-group" style="flex: 1; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.375rem;">
                        <button type="submit" class="btn btn-sm btn-primary">Agregar</button>
                    </div>
                </form>
            </div>

            <div class="mb-3">
                <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">Gastos Diarios</h3>
                <div id="categoriesDiario"></div>
                <form id="addCategoryDiario" class="mt-2">
                    <div class="flex gap-2">
                        <input type="text" name="newCategory" placeholder="Nueva categor铆a diaria" class="form-group" style="flex: 1; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.375rem;">
                        <button type="submit" class="btn btn-sm btn-primary">Agregar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Income Categories -->
        <div class="card">
            <div class="card-header">Gesti贸n de Categor铆as de Ingresos</div>
            
            <div class="mb-3">
                <div id="incomeCategories"></div>
                <form id="addIncomeCategory" class="mt-2">
                    <div class="flex gap-2">
                        <input type="text" name="newCategory" placeholder="Nueva categor铆a de ingreso" class="form-group" style="flex: 1; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.375rem;">
                        <button type="submit" class="btn btn-sm btn-success">Agregar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Data Management -->
        <div class="card">
            <div class="card-header">Gesti贸n de Datos</div>
            
            <div class="mb-3">
                <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">Importaci贸n Masiva</h3>
                <p style="color: #6b7280; margin-bottom: 1rem;">
                    Importa m煤ltiples gastos o ingresos desde un archivo CSV o Excel. El archivo debe tener las siguientes columnas:
                </p>
                <ul style="color: #6b7280; margin-left: 1.5rem; margin-bottom: 1rem;">
                    <li><strong>Para gastos:</strong> fecha, tipo, categoria, monto, pagado_por, es_comun, descripcion</li>
                    <li><strong>Para ingresos:</strong> fecha, categoria, monto, recibido_por, descripcion</li>
                </ul>
                
                <div class="form-group">
                    <label>Tipo de importaci贸n</label>
                    <select id="importType" style="max-width: 200px;">
                        <option value="expenses">Gastos</option>
                        <option value="incomes">Ingresos</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="fileImport">Selecciona archivo CSV o Excel</label>
                    <input type="file" id="fileImport" accept=".csv,.xlsx,.xls" style="margin-bottom: 1rem;">
                </div>
                
                <button id="btnImport" class="btn btn-primary">Importar Datos</button>
                
                <div id="importResults" style="margin-top: 1rem; display: none;"></div>
            </div>

            <hr style="margin: 2rem 0;">

            <div class="flex gap-2">
                <button id="btnExportAll" class="btn btn-success">Exportar Todos los Datos (JSON)</button>
                <button id="btnExportCSV" class="btn btn-success">Exportar Gastos (CSV)</button>
                <button id="btnDownloadTemplate" class="btn btn-secondary">Descargar Plantilla CSV</button>
            </div>
            <p class="mt-2" style="color: #6b7280; font-size: 0.875rem;">
                Los datos se guardan autom谩ticamente en el servidor local. Puedes exportarlos como respaldo.
            </p>
        </div>

        <!-- Info -->
        <div class="card" style="background: #f9fafb; border: 1px solid #e5e7eb;">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">癸 Informaci贸n</h3>
            <ul style="list-style: disc; margin-left: 1.5rem; color: #6b7280;">
                <li>Los datos se almacenan localmente en: <code style="background: #e5e7eb; padding: 0.25rem 0.5rem; border-radius: 0.25rem;">expense-tracker/data/</code></li>
                <li>Los cambios se guardan autom谩ticamente</li>
                <li>El porcentaje de divisi贸n se aplica solo a gastos marcados como "com煤n"</li>
                <li>Las categor铆as se pueden eliminar si no est谩n en uso</li>
            </ul>
        </div>
    </div>

    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/settings.js"></script>
</body>
</html>
